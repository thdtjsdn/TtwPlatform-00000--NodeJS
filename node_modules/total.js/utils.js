"use strict";function dnsresolve_callback(e,t){Dns.resolve4(e.hostname,function(r,n){return r?t(r,e):(dnscache[e.host]=n[0],e.host=n[0],void t(null,e))})}function request_call(e,t){var r="https:"===e.protocol?Https:Http,n=t.post?r.request(e,function(r){return request_response(r,e,t)}):r.get(e,function(r){return request_response(r,e,t)});return t.callback?(n.on("error",function(r){t.callback&&(t.callback(r,"",0,void 0,e.host),t.callback=null,t.evt.removeAllListeners(),t.evt=null)}),n.setTimeout(t.timeout,function(){t.callback&&(t.callback(new Error(exports.httpStatus(408)),"",0,void 0,e.host),t.callback=null,t.evt.removeAllListeners(),t.evt=null)}),n.on("response",function(e){return e.req=n}),void(t.upload?(t.first=!0,t.files.wait(function(e,r){request_writefile(n,t,e,r)},function(){for(var e=Object.keys(t.data),r=0,i=e.length;i>r;r++){var o=t.data[e[r]];null!=o&&(n.write((t.first?"":NEWLINE)+"--"+t.boundary+NEWLINE+'Content-Disposition : form-data; name="'+e[r]+'"'+NEWLINE+NEWLINE+encodeURIComponent(o.toString())),t.first&&(t.first=!1))}n.end("\r\n--"+t.boundary+"--")})):n.end(t.data))):void n.on("error",NOOP)}function request_writefile(e,t,r,n){var i=typeof r.buffer,o="string"===i?r.buffer:exports.getName(r.filename);if(e.write((t.first?"":NEWLINE)+"--"+t.boundary+NEWLINE+'Content-Disposition : form-data; name="'+r.name+'"; filename="'+o+'"'+NEWLINE+"Content-Type : "+exports.getContentType(exports.getExtension(o))+NEWLINE+NEWLINE),t.first&&(t.first=!1),r.buffer&&"object"===i)e.write(r.buffer),n();else{var s=Fs.createReadStream(r.filename);s.once("close",n),s.pipe(e,STREAMPIPE)}}function request_response(e,t,r){if(e._buffer=null,e._bufferlength=0,301===e.statusCode||302===e.statusCode){if(r.noredirect)return r.callback&&(r.callback(null,"",e.statusCode,e.headers,t.host,EMPTYOBJECT),r.callback=null),r.evt&&(r.evt.removeAllListeners(),r.evt=null),e.req.removeAllListeners(),e.req=null,e.removeAllListeners(),void(e=null);if(r.redirect>3)return r.callback&&(r.callback(new Error("Too many redirects."),"",0,void 0,t.host,EMPTYOBJECT),r.callback=null),r.evt&&(r.evt.removeAllListeners(),r.evt=null),e.req.removeAllListeners(),e.req=null,e.removeAllListeners(),void(e=null);r.redirect++;var n=Url.parse(e.headers.location);return n.headers=t.headers,n.agent=!1,n.method=t.method,e.req.removeAllListeners(),e.req=null,r.resolve?void exports.resolve(e.headers.location,function(t,i){t||(n.host=i.host),e.removeAllListeners(),e=null,request_call(n,r)}):(e.removeAllListeners(),e=null,request_call(n,r))}if(r.length=+e.headers["content-length"]||0,r.evt&&r.evt.$events.begin&&r.evt.emit("begin",r.length),r.cookies){var i=e.headers["set-cookie"]||"";if(!i||i instanceof Array||(i=[i]),i instanceof Array)for(var o=0,s=i.length;s>o;o++){var a=i[o],u=a.indexOf(";");-1===u&&(u=a.length),a=a.substring(0,u);var c=a.indexOf("=");-1!==c&&(r.cookies[a.substring(0,c)]=decodeURIComponent(a.substring(c+1)))}}e.on("data",function(e){var t=this;r.max&&t._bufferlength>r.max||(t._buffer?(CONCAT[0]=t._buffer,CONCAT[1]=e,t._buffer=Buffer.concat(CONCAT)):t._buffer=e,t._bufferlength+=e.length,r.evt&&r.evt.$events.data&&r.evt.emit("data",e,r.length?t._bufferlength/r.length*100:0))}),e.on("end",function(){var n=this,i=n._buffer?n._buffer.toString(r.encoding):"";n._buffer=void 0,r.evt&&(r.evt.$events.end&&r.evt.emit("end",i,n.statusCode,n.headers,t.host,r.cookies),r.evt.removeAllListeners(),r.evt=null),r.callback&&(r.callback(null,"HEAD"===t.method?n.headers:i,n.statusCode,n.headers,t.host,r.cookies),r.callback=null),e.req&&e.req.removeAllListeners(),e.removeAllListeners()}),e.resume()}function download_call(e,t){t.length=0;var r="https:"===e.protocol?Https:Http,n=t.post?r.request(e,function(r){return download_response(r,e,t)}):r.get(e,function(r){return download_response(r,e,t)});return t.callback?(n.on("error",function(e){t.callback&&(t.callback(e),t.callback=null,t.evt.removeAllListeners(),t.evt=null)}),n.setTimeout(t.timeout,function(){t.callback&&(t.callback(new Error(exports.httpStatus(408))),t.callback=null,t.evt.removeAllListeners(),t.evt=null)}),n.on("response",function(e){e.req=n,t.length=+e.headers["content-length"]||0,t.evt&&t.evt.$events.begin&&t.evt.emit("begin",t.length)}),void n.end(t.data)):void n.on("error",NOOP)}function download_response(e,t,r){if(e._bufferlength=0,301===e.statusCode||302===e.statusCode){if(r.redirect>3)return r.callback&&r.callback(new Error("Too many redirects.")),e.req.removeAllListeners(),e.req=null,e.removeAllListeners(),void(e=null);r.redirect++;var n=Url.parse(e.headers.location);return n.headers=t.headers,n.agent=!1,n.method=t.method,e.req.removeAllListeners(),e.req=null,r.resolve?void exports.resolve(e.headers.location,function(t,i){t||(n.host=i.host),e.removeAllListeners(),e=null,download_call(n,r)}):(e.removeAllListeners(),e=null,download_call(n,r))}e.on("data",function(e){var t=this;t._bufferlength+=e.length,r.evt&&r.evt.$events.data&&r.evt.emit("data",e,r.length?t._bufferlength/r.length*100:0)}),e.on("end",function(){var n=this,i=n._buffer?n._buffer.toString(r.encoding):"";n._buffer=void 0,r.evt&&(r.evt.$events.end&&r.evt.emit("end",i,n.statusCode,n.headers,t.host),r.evt.removeAllListeners(),r.evt=null),e.req&&e.req.removeAllListeners(),e.removeAllListeners()}),e.resume(),r.callback&&r.callback(null,e,e.statusCode,e.headers,t.host)}function rnd(){return Math.floor(65536*Math.random()).toString(36)}function validate_builder_default(e,t,r){var n=typeof t;if(r.type>7)return void 0!==t;switch(r.subtype){case"uid":var i=parseInt(t.substring(10,t.length-4),10);return isNaN(i)?!1:t[t.length-1]===(i%2?"1":"0");case"zip":return t.isZIP();case"email":return t.isEmail();case"json":return t.isJSON();case"url":return t.isURL();case"phone":return t.isPhone()}return"number"===n?t>0:"string"===n||t instanceof Array?t.length>0:"boolean"===n?t===!0:null==t?!1:t instanceof Date?"I"!==t.toString()[0]:!0}function jsonparser(e,t){return"string"==typeof t&&t.isJSONDate()?new Date(t):t}function getWebSocketFrameMessageBytes(e,t){for(var r=e?2:0,n=t instanceof Int8Array||t instanceof Buffer,i=t.length,o=exports.createBufferSize(i+r),s=0;i>s;s++)n?o[s+r]=t[s]:o[s+r]=t.charCodeAt(s);return e&&(o[0]=e>>8,o[1]=e),o}function getWebSocketFrameLengthBytes(e){var t=null;return 125>=e?(t=exports.createBufferSize(1),t[0]=e,t):65535>=e?(t=exports.createBufferSize(3),t[0]=126,t[1]=e>>8&255,t[2]=255&e,t):(t=exports.createBufferSize(9),t[0]=127,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e>>24&255,t[6]=e>>16&255,t[7]=e>>8&255,t[8]=255&e,t)}function string_hash(e,t){var r=0;if(0===e.length)return t?"":r;for(var n=0,i=e.length;i>n;n++){var o=e.charCodeAt(n);r=(r<<5)-r+o,r|=0}return r}function parseTerminal2(e,t,r,n){var i=0;void 0===r&&(r=0),void 0===n&&(n=e.length);for(var o=r,s=r+n;s>o;o++){var a=e[o];if(a){var u=a.match(regexpTERMINAL);u&&t(u,i++,s,o)}}}function filesizehelper(e,t){for(;t--;)if(e/=1024,"0.000"===e.toFixed(3))return 0;return e}function next_wait(e,t,r,n,i){i.pending--,e.wait(t,r,n,i)}function AsyncTask(e,t,r,n,i){this.isRunning=0,this.owner=e,this.name=t,this.fn=r,this.cb=n,this.waiting=i,this.interval=null,this.isCanceled=!1}function Async(e){this._max=0,this._count=0,this._isRunning=!1,this._isEnd=!1,this.owner=e,this.onComplete=[],this.tasksPending={},this.tasksWaiting={},this.tasksAll=[],this.tasksTimeout={},this.isCanceled=!1,Events.EventEmitter.call(this)}function FileList(){this.pending=[],this.pendingDirectory=[],this.directory=[],this.file=[],this.onComplete=null,this.onFilter=null,this.advanced=!1}function converBytesToInt64(e,t,r){return r?e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24|e[t+4]<<32|e[t+5]<<40|e[t+6]<<48|e[t+7]<<56:e[t+7]<<32|e[t+6]<<40|e[t+5]<<48|e[t+4]<<56|e[t+3]|e[t+2]<<8|e[t+1]<<16|e[t]<<24}function queue_next(e){var t=exports.queuecache[e];if(t&&(t.running--,t.running<0&&(t.running=0),t.pending.length)){var r=t.pending.shift();r?(t.running++,setImmediate(queue_next_callback,r,e)):t.running=0}}function queue_next_callback(e,t){e(function(){return queue_next(t)})}function _shellInsertionSort(e,t,r,n){var i,o,s;for(o=r;t>o;o+=r)for(s=o;s>0&&1===n(e[s-r],e[s]);)i=e[s],e[s]=e[s-r],e[s-r]=i,s-=r}function shellsort(e,t){for(var r=e.length,n=Math.floor(r/2);n;)_shellInsertionSort(e,r,n,t),n=Math.floor(n/2);return e}function EventEmitter2(){this.$events={}}function Chunker(e,t){this.name=e,this.max=t||50,this.index=0,this.filename="chunker_{0}-".format(e),this.stack=[],this.flushing=0,this.pages=0,this.count=0,this.filename=F.path.temp(this.filename)}const Dns=require("dns"),Url=require("url"),Qs=require("querystring"),Http=require("http"),Https=require("https"),Path=require("path"),Fs=require("fs"),Events=require("events"),Crypto=require("crypto"),CONCAT=[null,null],COMPARER=global.Intl?global.Intl.Collator().compare:function(e,t){return e.removeDiacritics().localeCompare(t.removeDiacritics())};global.framework_utils||(global.framework_utils=exports);var regexpSTATIC=/\.\w{2,8}($|\?)+/;const regexpTRIM=/^[\s]+|[\s]+$/g,regexpDATE=/(\d{1,2}\.\d{1,2}\.\d{4})|(\d{4}-\d{1,2}-\d{1,2})|(\d{1,2}:\d{1,2}(:\d{1,2})?)/g,regexpDATEFORMAT=/yyyy|yy|M+|d+|HH|H|hh|h|mm|m|ss|s|a|ww|w/g,regexpSTRINGFORMAT=/\{\d+\}/g,regexpPATH=/\\/g,regexpTags=/<\/?[^>]+(>|$)/g,regexpDiacritics=/[^\u0000-\u007e]/g,regexpXML=/\w+=".*?"/g,regexpDECODE=/&#?[a-z0-9]+;/g,regexpPARAM=/\{{2}[^}\n]*\}{2}/g,regexpARG=/\{[^}\n]*\}/g,regexpINTEGER=/(^-|\s-)?[0-9]+/g,regexpFLOAT=/(^-|\s-)?[0-9.,]+/g,regexpALPHA=/^[A-Za-z0-9]+$/,regexpSEARCH=/[^a-zA-Zá-žÁ-Ž\d\s:]/g,regexpDECRYPT=/-|_/g,regexpENCRYPT=/\/|\+/g,regexpUNICODE=/\\u([\d\w]{4})/gi,regexpTERMINAL=/[\w\S]+/g,SOUNDEX={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6},ENCODING="utf8",NEWLINE="\r\n",isWindows="win"===require("os").platform().substring(0,3).toLowerCase(),DIACRITICSMAP={},STREAM_READONLY={flags:"r"},STREAM_END={end:!1},ALPHA_INDEX={"&lt":"<","&gt":">","&quot":'"',"&apos":"'","&amp":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'","&amp;":"&"},EMPTYARRAY=[],EMPTYOBJECT=[],NODEVERSION=parseFloat(process.version.toString().replace("v","").replace(/\./g,"")),STREAMPIPE={end:!1};exports.MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],exports.DAYS=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Object.freeze(EMPTYARRAY),Object.freeze(EMPTYOBJECT);for(var DIACRITICS=[{b:" ",c:" "},{b:"0",c:"߀"},{b:"A",c:"ⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{b:"AA",c:"Ꜳ"},{b:"AE",c:"ÆǼǢ"},{b:"AO",c:"Ꜵ"},{b:"AU",c:"Ꜷ"},{b:"AV",c:"ꜸꜺ"},{b:"AY",c:"Ꜽ"},{b:"B",c:"ⒷＢḂḄḆɃƁ"},{b:"C",c:"ⒸＣꜾḈĆCĈĊČÇƇȻ"},{b:"D",c:"ⒹＤḊĎḌḐḒḎĐƊƉᴅꝹ"},{b:"Dh",c:"Ð"},{b:"DZ",c:"ǱǄ"},{b:"Dz",c:"ǲǅ"},{b:"E",c:"ɛⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎᴇ"},{b:"F",c:"ꝼⒻＦḞƑꝻ"},{b:"G",c:"ⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾɢ"},{b:"H",c:"ⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{b:"I",c:"ⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{b:"J",c:"ⒿＪĴɈȷ"},{b:"K",c:"ⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{b:"L",c:"ⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{b:"LJ",c:"Ǉ"},{b:"Lj",c:"ǈ"},{b:"M",c:"ⓂＭḾṀṂⱮƜϻ"},{b:"N",c:"ꞤȠⓃＮǸŃÑṄŇṆŅṊṈƝꞐᴎ"},{b:"NJ",c:"Ǌ"},{b:"Nj",c:"ǋ"},{b:"O",c:"ⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{b:"OE",c:"Œ"},{b:"OI",c:"Ƣ"},{b:"OO",c:"Ꝏ"},{b:"OU",c:"Ȣ"},{b:"P",c:"ⓅＰṔṖƤⱣꝐꝒꝔ"},{b:"Q",c:"ⓆＱꝖꝘɊ"},{b:"R",c:"ⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{b:"S",c:"ⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{b:"T",c:"ⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{b:"Th",c:"Þ"},{b:"TZ",c:"Ꜩ"},{b:"U",c:"ⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{b:"V",c:"ⓋＶṼṾƲꝞɅ"},{b:"VY",c:"Ꝡ"},{b:"W",c:"ⓌＷẀẂŴẆẄẈⱲ"},{b:"X",c:"ⓍＸẊẌ"},{b:"Y",c:"ⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{b:"Z",c:"ⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{b:"a",c:"ⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{b:"aa",c:"ꜳ"},{b:"ae",c:"æǽǣ"},{b:"ao",c:"ꜵ"},{b:"au",c:"ꜷ"},{b:"av",c:"ꜹꜻ"},{b:"ay",c:"ꜽ"},{b:"b",c:"ⓑｂḃḅḇƀƃɓƂ"},{b:"c",c:"ｃⓒćĉċčçḉƈȼꜿↄ"},{b:"d",c:"ⓓｄḋďḍḑḓḏđƌɖɗƋᏧԁꞪ"},{b:"dh",c:"ð"},{b:"dz",c:"ǳǆ"},{b:"e",c:"ⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇǝ"},{b:"f",c:"ⓕｆḟƒ"},{b:"ff",c:"ﬀ"},{b:"fi",c:"ﬁ"},{b:"fl",c:"ﬂ"},{b:"ffi",c:"ﬃ"},{b:"ffl",c:"ﬄ"},{b:"g",c:"ⓖｇǵĝḡğġǧģǥɠꞡꝿᵹ"},{b:"h",c:"ⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{b:"hv",c:"ƕ"},{b:"i",c:"ⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{b:"j",c:"ⓙｊĵǰɉ"},{b:"k",c:"ⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{b:"l",c:"ⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇɭ"},{b:"lj",c:"ǉ"},{b:"m",c:"ⓜｍḿṁṃɱɯ"},{b:"n",c:"ⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{b:"nj",c:"ǌ"},{b:"o",c:"ⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿꝋꝍɵɔᴑ"},{b:"oe",c:"œ"},{b:"oi",c:"ƣ"},{b:"oo",c:"ꝏ"},{b:"ou",c:"ȣ"},{b:"p",c:"ⓟｐṕṗƥᵽꝑꝓꝕρ"},{b:"q",c:"ⓠｑɋꝗꝙ"},{b:"r",c:"ⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{b:"s",c:"ⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛʂ"},{b:"ss",c:"ß"},{b:"t",c:"ⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{b:"th",c:"þ"},{b:"tz",c:"ꜩ"},{b:"u",c:"ⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{b:"v",c:"ⓥｖṽṿʋꝟʌ"},{b:"vy",c:"ꝡ"},{b:"w",c:"ⓦｗẁẃŵẇẅẘẉⱳ"},{b:"x",c:"ⓧｘẋẍ"},{b:"y",c:"ⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{b:"z",c:"ⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],i=0;i<DIACRITICS.length;i+=1)for(var chars=DIACRITICS[i].c,j=0;j<chars.length;j+=1)DIACRITICSMAP[chars[j]]=DIACRITICS[i].b;DIACRITICS=null;var CONTENTTYPES={aac:"audio/aac",ai:"application/postscript",appcache:"text/cache-manifest",avi:"video/avi",bin:"application/octet-stream",bmp:"image/bmp",coffee:"text/coffeescript",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/msword",dtd:"application/xml-dtd",eps:"application/postscript",exe:"application/octet-stream",flac:"audio/x-flac",geojson:"application/json",gif:"image/gif",gzip:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",ifb:"text/calendar",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsx:"text/jsx",less:"text/css",m4a:"audio/mp4a-latm",m4v:"video/x-m4v",manifest:"text/cache-manifest",md:"text/x-markdown",mid:"audio/midi",midi:"audio/midi",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",mtl:"text/plain",mv4:"video/mv4",obj:"text/plain",ogg:"application/ogg",ogv:"video/ogg","package":"text/plain",pdf:"application/pdf",png:"image/png",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.ms-powerpoint",ps:"application/postscript",rar:"application/x-rar-compressed",rtf:"text/rtf",sass:"text/css",scss:"text/css",sh:"application/x-sh",stl:"application/sla",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",webm:"video/webm",webp:"image/webp",woff:"application/font-woff",woff2:"application/font-woff2",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",zip:"application/zip"},persistentcookies={},dnscache={},datetimeformat={};const hasOwnProperty=Object.prototype.hasOwnProperty;exports.isEmpty=function(e){if(!e)return!0;if(e.length)return!1;for(var t in e)if(hasOwnProperty.call(e,t))return!1;return!0},exports.isEqual=function(e,t,r){for(var n=r?r:Object.keys(e),i=0,o=n.length;o>i;i++){var s=n[i],a=e[s],u=t[s],c=typeof a,l=typeof u;if(c!==l)return!1;if(a!==u){if(a instanceof Date&&u instanceof Date){if(a.getTime()===u.getTime())continue;return!1}if(a instanceof Array&&u instanceof Array){if(JSON.stringify(a)===JSON.stringify(u))continue;return!1}if("object"!==c||"object"!==l||!exports.isEqual(a,u))return!1}}return!0},exports.wait=function(e,t,r,n){if(e()===!0)return t(null,!0);var i=null,o=setInterval(function(){return e()===!0?(clearInterval(o),clearTimeout(i),void(t&&t(null,!0))):void 0},n||500);i=setTimeout(function(){clearInterval(o),t&&t(new Error("Timeout."),!1)},r||5e3)},exports.$$wait=function(e,t,r){return function(n){exports.wait(e,n,t,r)}},exports.resolve=function(e,t){var r=Url.parse(e);return t?dnscache[r.host]?(r.host=dnscache[r.host],void t(null,r)):void Dns.resolve4(r.hostname,function(e,n){e?setImmediate(dnsresolve_callback,r,t):(dnscache[r.host]=n[0],r.host=n[0],t(null,r))}):dnscache[r.host]},exports.$$resolve=function(e){return function(t){return exports.resolve(e,t)}},exports.clearDNS=function(){dnscache={}},exports.keywords=function(e,t,r,n,i,o){void 0===t&&(t=!0),o=o||2,n=n||200,i=i||20;var s=[],a="soundex"===r;if(e instanceof Array){for(var u=0,c=e.length;c>u;u++)if(e[u]){var l=(t?e[u].removeDiacritics().toLowerCase().replace(/y/g,"i"):e[u].toLowerCase()).replace(/\n/g," ").split(" ");if(l&&l.length)for(var f=0,p=l.length;p>f;f++)s.push(l[f])}}else s=(t?e.removeDiacritics().toLowerCase().replace(/y/g,"i"):e.toLowerCase()).replace(/\n/g," ").split(" ");s||(s=[]);for(var h={},g=0,u=0,c=s.length;c>u;u++){var d=s[u].trim();if(!(d.length<o)){if(g>=n)break;if(t&&(d=d.replace(/\W|_/g,"")),r)if(a)d=d.soundex();else{var v=d.length/100*80;v>o+1&&(d=d.substring(0,v))}d.length<o||d.length>i||(h[d]?h[d]++:h[d]=1,g++)}}var m=Object.keys(h);return m.sort(function(e,t){var r=h[e],n=h[t];return r>n?-1:n>r?1:0}),m},exports.request=function(e,t,r,n,i,o,s,a,u){"function"==typeof r?(s=o,o=i,i=n,n=r,r=""):r||(r=""),n===NOOP&&(n=null);var c,l={length:0,timeout:a||1e4,evt:new EventEmitter2,encoding:"string"!=typeof s?ENCODING:s,callback:n,post:!1,redirect:0},f=0,p=!1;if(o=o?exports.extend({},o):{},t instanceof Array)for(var h=0,g=t.length;g>h;h++)if(t[h]>0)l.timeout=t[h];else if("<"!==t[h][0])switch(t[h].toLowerCase()){case"utf8":case"ascii":case"base64":case"binary":case"hex":l.encoding=t[h];break;case"xhr":o["X-Requested-With"]="XMLHttpRequest";break;case"plain":o["Content-Type"]="text/plain";break;case"html":o["Content-Type"]="text/html";break;case"raw":f=3,o["Content-Type"]="application/octet-stream";break;case"json":o["Content-Type"]="application/json",!c&&(c="POST"),f=1;break;case"xml":o["Content-Type"]="text/xml",!c&&(c="POST"),f=2;break;case"get":case"options":case"head":c=t[h].toUpperCase();break;case"noredirect":l.noredirect=!0;break;case"upload":f=4,l.upload=!0,l.files=u||EMPTYARRAY,l.boundary="----totaljs"+Math.random().toString(16).substring(2),o["Content-Type"]="multipart/form-data; boundary="+l.boundary;break;case"post":case"put":case"delete":case"patch":c=t[h].toUpperCase(),!o["Content-Type"]&&(o["Content-Type"]="application/x-www-form-urlencoded");break;case"dnscache":l.resolve=!0;break;case"cookies":p=!0}else l.max=1024*t[h].substring(1).trim().parseInt();if(c?l.post="POST"===c||"PUT"===c||"DELETE"===c||"PATCH"===c:c="GET",3>f&&("string"!=typeof r?r=1===f?JSON.stringify(r):Qs.stringify(r):"?"===r[0]&&(r=r.substring(1)),l.post||(r.length&&-1===e.indexOf("?")&&(e+="?"+r),r="")),r&&4!==f?(l.data=r instanceof Buffer?r:exports.createBuffer(r,ENCODING),o["Content-Length"]=l.data.length):l.data=r,i){p&&(l.cookies=i);var d="";for(var v in i)d+=(d?"; ":"")+v+"="+i[v];d&&(o.Cookie=d)}var m=Url.parse(e);return m.method=c,m.agent=!1,m.headers=o,l.resolve?exports.resolve(e,function(e,t){!e&&(m.host=t.host),request_call(m,l)}):request_call(m,l),l.evt},exports.$$request=function(e,t,r,n,i,o,s){return function(a){exports.request(e,t,r,a,n,i,o,s)}},exports.btoa=function(e){return e instanceof Buffer?e.toString("base64"):exports.createBuffer(e.toString(),"binary").toString("base64")},exports.atob=function(e){return exports.createBuffer(e,"base64").toString("binary")},exports.download=function(e,t,r,n,i,o,s,a){"function"==typeof r&&(a=s,s=o,o=i,i=n,n=r,r=""),"number"==typeof i&&(i=null,a=i),"number"==typeof o&&(o=null,a=o),"number"==typeof s&&(s=null,a=s),"string"!=typeof s&&(s=ENCODING);var u="GET",c=0,l={callback:n,resolve:!1,length:0,evt:new EventEmitter2,timeout:a||6e4,post:!1,encoding:s};if(o=o?exports.extend({},o):{},null===r&&(r=""),t instanceof Array)for(var f=0,p=t.length;p>f;f++)if(t[f]>0)l.timeout=t[f];else if("<"!==t[f][0])switch(t[f].toLowerCase()){case"utf8":case"ascii":case"base64":case"binary":case"hex":l.encoding=t[f];break;case"xhr":o["X-Requested-With"]="XMLHttpRequest";break;case"plain":o["Content-Type"]="text/plain";break;case"html":o["Content-Type"]="text/html";break;case"json":o["Content-Type"]="application/json",c=1;break;case"xml":o["Content-Type"]="text/xml",c=2;break;case"get":case"head":case"options":u=t[f].toUpperCase();break;case"upload":o["Content-Type"]="multipart/form-data";break;case"post":case"patch":case"delete":case"put":u=t[f].toUpperCase(),o["Content-Type"]||(o["Content-Type"]="application/x-www-form-urlencoded");break;case"dnscache":l.resolve=!0}if(l.post="POST"===u||"PUT"===u||"DELETE"===u||"PATCH"===u,"string"!=typeof r?r=1===c?JSON.stringify(r):Qs.stringify(r):"?"===r[0]&&(r=r.substring(1)),l.post||(r.length&&-1===e.indexOf("?")&&(e+="?"+r),r=""),i){var h="";for(var g in i)h+=(h?"; ":"")+g+"="+i[g];h&&(o.Cookie=h)}var d=Url.parse(e);return d.method=u,d.agent=!1,d.headers=o,r.length&&(l.data=exports.createBuffer(r,ENCODING),o["Content-Length"]=l.data.length),l.resolve?exports.resolve(e,function(e,t){!e&&(d.host=t.host),download_call(d,l)}):download_call(d,l),l.evt},exports.$$download=function(e,t,r,n,i,o,s){return function(a){exports.download(e,t,r,a,n,i,o,s)}},exports.send=function(e,t,r,n,i,o,s,a){OBSOLETE("U.send()","Use U.upload() instead of U.send()."),"string"==typeof t&&(t=Fs.createReadStream(t,STREAM_READONLY));var u="----totaljs"+Math.random().toString(16).substring(2),c={};if(o&&exports.extend(c,o),i){var l="";for(var f in i)l+=(l?"; ":"")+f+"="+i[f];l&&(c.Cookie=l)}e=exports.getName(e),c["Cache-Control"]="max-age=0",c["Content-Type"]="multipart/form-data; boundary="+u;var p=new EventEmitter2,h=Url.parse(r),g={protocol:h.protocol,auth:h.auth,method:s||"POST",hostname:h.hostname,port:h.port,path:h.path,agent:!1,headers:c},d=0,v=function(e){e.body=exports.createBufferSize(),e._bufferlength=0,e.on("data",function(t){CONCAT[0]=e.body,CONCAT[1]=t,e.body=Buffer.concat(CONCAT),e._bufferlength+=t.length,p.$events.data&&p.emit("data",t,d?e._bufferlength/d*100:0)}),e.on("end",function(){var e=this;p.$events.end&&p.emit("end",e.statusCode,e.headers),p.removeAllListeners(),p=null,n&&n(null,e.body.toString("utf8"),e.statusCode,e.headers,h.host),e.body=null})},m="https:"===g.protocol?Https:Http,y=m.request(g,v);y.on("response",function(e){d=+e.headers["content-length"]||0,p.$events.begin&&p.emit("begin",d)}),y.setTimeout(a||6e4,function(){y.removeAllListeners(),y=null,p.removeAllListeners(),p=null,n&&n(new Error(exports.httpStatus(408)),"",408,void 0,h.host)}),y.on("error",function(e){y.removeAllListeners(),y=null,p.removeAllListeners(),p=null,n&&n(e,"",0,void 0,h.host)}),y.on("close",function(){y.removeAllListeners(),y=null});var b="\r\n\r\n--"+u+NEWLINE+'Content-Disposition: form-data; name="File"; filename="'+e+'"'+NEWLINE+"Content-Type: "+exports.getContentType(exports.getExtension(e))+NEWLINE+NEWLINE;return y.write(b),t.length?(y.write(t),y.end("\r\n\r\n--"+u+"--"),p):(t.on("end",function(){return y.end("\r\n\r\n--"+u+"--")}),t.pipe(y,STREAM_END),p)},exports.$$send=function(e,t,r,n,i,o,s){return function(a){exports.send(e,t,r,a,n,i,o,s)}},exports.upload=function(e,t,r,n,i,o,s){var a="----totaljs"+Math.random().toString(16).substring(2),u={};if(i&&exports.extend_headers2(u,i),n){var c="";for(var l in n)c+=(c?"; ":"")+l+"="+n[l];c&&(u.Cookie=c)}u["Cache-Control"]="max-age=0",u["Content-Type"]="multipart/form-data; boundary="+a;var f=new EventEmitter2,p=Url.parse(t),h={protocol:p.protocol,auth:p.auth,method:o||"POST",hostname:p.hostname,port:p.port,path:p.path,agent:!1,headers:u},g=0,d=function(e){e.body=exports.createBufferSize(),e._bufferlength=0,e.on("data",function(t){CONCAT[0]=e.body,CONCAT[1]=t,e.body=Buffer.concat(CONCAT),e._bufferlength+=t.length,f.$events.data&&f.emit("data",t,g?e._bufferlength/g*100:0)}),e.on("end",function(){var e=this;f.$events.end&&f.emit("end",e.statusCode,e.headers),f.removeAllListeners(),f=null,r&&r(null,e.body.toString("utf8"),e.statusCode,e.headers,p.host),e.body=null})},v="https:"===h.protocol?Https:Http,m=v.request(h,d);m.on("response",function(e){g=+e.headers["content-length"]||0,f.$events.begin&&f.emit("begin",g)}),m.setTimeout(s||6e4,function(){m.removeAllListeners(),m=null,f.removeAllListeners(),f=null,r&&r(new Error(exports.httpStatus(408)),"",408,void 0,p.host)}),m.on("error",function(e){m.removeAllListeners(),m=null,f.removeAllListeners(),f=null,r&&r(e,"",0,void 0,p.host)}),m.on("close",function(){m.removeAllListeners(),m=null});var y="\r\n\r\n--"+a+NEWLINE+'Content-Disposition: form-data; name="{0}"; filename="{1}"'+NEWLINE+"Content-Type: {2}"+NEWLINE+NEWLINE;return e.waitFor(function(e,t){return m.write(y.format(e.name,U.getName(e.filename),exports.getContentType(exports.getExtension(e.filename)))),e.buffer?(m.write(e.buffer),t()):(!e.stream&&(e.stream=Fs.createReadStream(e.filename)),e.stream.pipe(m,STREAM_END),e.stream.on("error",t),void e.stream.on("end",t))},function(){return m.end("\r\n\r\n--"+a+"--")}),f},exports.$$upload=function(e,t,r,n,i,o){return function(s){exports.upload(e,t,s,r,n,i,o)}},exports.trim=function(e,t){if(!e)return e;var r=typeof e;if("string"===r)return e=e.trim(),t&&!e?void 0:e;if(e instanceof Array){for(var n=0,i=e.length;i>n;n++){var o=e[n];r=typeof o,"object"!==r?"string"===r&&(e[n]=o.trim(),t&&!e[n]&&(e[n]=void 0)):exports.trim(o,t)}return e}if("object"!==r)return e;for(var s=Object.keys(e),n=0,i=s.length;i>n;n++){var a=e[s[n]],r=typeof a;"object"!==r?"string"===r&&(e[s[n]]=a.trim(),t&&!e[s[n]]&&(e[s[n]]=void 0)):exports.trim(a,t)}return e},exports.noop=global.noop=global.NOOP=function(){},exports.httpStatus=function(e,t){return void 0===t&&(t=!0),(t?e+": ":"")+Http.STATUS_CODES[e]},exports.extend=function(e,t,r){if(!e||!t)return e;if("object"!=typeof e||"object"!=typeof t)return e;void 0===r&&(r=!0);for(var n=Object.keys(t),i=n.length;i--;){var o=n[i];(r||void 0===e[o])&&(e[o]=exports.clone(t[o]))}return e},exports.extend_headers=function(e,t){for(var r=Object.keys(e),n={},i=r.length;i--;)n[r[i]]=e[r[i]];for(r=Object.keys(t),i=r.length;i--;)n[r[i]]=t[r[i]];return n},exports.extend_headers2=function(e,t){for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e},global.CLONE=exports.clone=function(e,t,r){if(!e)return e;var n=typeof e;if("object"!==n||e instanceof Date)return e;var i,o;if(e instanceof Array){i=e.length,o=new Array(i);for(var s=0;i>s;s++)if(n=typeof e[s],"object"!==n||e[s]instanceof Date){if(r&&"function"===n)continue;o[s]=e[s]}else o[s]=exports.clone(e[s],t,r);return o}o={};for(var a in e)if(!t||!t[a]){var u=e[a];if(u instanceof Buffer){var c=exports.createBufferSize(u.length);u.copy(c),o[a]=c}else{var n=typeof u;if("object"!==n||u instanceof Date){if(r&&"function"===n)continue;o[a]=u}else o[a]=exports.clone(e[a],t,r)}}return o},exports.copy=function(e,t){if(void 0===t)return exports.extend({},e,!0);if(!t||!e||"object"!=typeof t||"object"!=typeof e)return t;for(var r=Object.keys(e),n=r.length;n--;){var i=r[n];void 0!==t[i]&&(t[i]=exports.clone(e[i]))}return t},exports.reduce=function(e,t,r){if(!(t instanceof Array)&&"object"==typeof t)return exports.reduce(e,Object.keys(t),r);if(e instanceof Array){for(var n=[],i=0,o=e.length;o>i;i++)n.push(exports.reduce(e[i],t,r));return n}var s={};return Object.keys(e).forEach(function(n){r?-1===t.indexOf(n)&&(s[n]=e[n]):-1!==t.indexOf(n)&&(s[n]=e[n])}),s},exports.assign=function(e,t,r){if(null==e)return e;for(var n=t.split("."),i=e[n[0]],o=1;o<n.length-1;o++)i=i[n[o]];return i[n[n.length-1]]="function"==typeof r?r(i[n[n.length-1]]):r,e},exports.isRelative=function(e){return!("//"===e.substring(0,2)||-1!==e.indexOf("http://")||-1!==e.indexOf("https://"))},exports.streamer=function(e,t,r,n,i){"function"==typeof t&&(i=n,n=r,r=t,t=void 0),"object"==typeof n&&(i=n,n=0);var o,s=0,a=exports.createBufferSize(),u=!1;if(void 0===n&&(n=0),e=exports.createBuffer(e,"utf8"),t&&(t=exports.createBuffer(t,"utf8")),!t){var c=e.length;return o=function(t){if(t&&!u){CONCAT[0]=a,CONCAT[1]=t,a=Buffer.concat(CONCAT);var i=a.indexOf(e);if(-1!==i)for(;-1!==i;){if(n?n--:r(a.toString("utf8",0,i+c),s++)===!1&&(u=!0),u)return;if(a=a.slice(i+c),i=a.indexOf(e),-1===i)return}}},i&&i.on("end",function(){return o(e)}),o}var l=e.length,f=t.length,p=-1,h=-1,g=!1;return o=function(i){if(i&&!u){if(CONCAT[0]=a,CONCAT[1]=i,a=Buffer.concat(CONCAT),!g){if(p=a.indexOf(e),-1===p)return;g=!0}if(!g||(h=a.indexOf(t,p+l),-1!==h))for(;-1!==p;){if(n?n--:r(a.toString("utf8",p,h+f),s++)===!1&&(u=!0),u)return;if(a=a.slice(h+f),g=!1,p=a.indexOf(e),-1===p)return;if(g=!0,h=a.indexOf(t,p+l),-1===h)return}}},i&&i.on("end",function(){return o(t)}),o},exports.encode=function(e){if(null==e)return"";var t=typeof e;return"string"!==t&&(e=e.toString()),e.encode()},exports.decode=function(e){if(null==e)return"";var t=typeof e;return"string"!==t&&(e=e.toString()),e.decode()},exports.isStaticFile=function(e){return regexpSTATIC.test(e)},exports.parseInt=function(e,t){if(null==e)return t||0;var r=typeof e;return"number"===r?e:("string"!==r?e.toString():e).parseInt(t)},exports.parseBool=exports.parseBoolean=function(e,t){if(null==e)return void 0===t?!1:t;var r=typeof e;return"boolean"===r?e:"number"===r?e>0:("string"!==r?e.toString():e).parseBool(t)},exports.parseFloat=function(e,t){if(null==e)return t||0;var r=typeof e;return"number"===r?e:("string"!==r?e.toString():e).parseFloat(t)},exports.isArray=function(e){return e instanceof Array},exports.isRegExp=function(e){return e&&"function"==typeof e.test?!0:!1},exports.isDate=function(e){return e instanceof Date&&!isNaN(e.getTime())?!0:!1},exports.isError=function(e){return e&&e.stack?!0:!1},exports.isObject=function(e){try{return e&&Object.getPrototypeOf(e)===Object.prototype?!0:!1}catch(t){return!1}},exports.getContentType=function(e){return"."===e[0]&&(e=e.substring(1)),CONTENTTYPES[e]||"application/octet-stream"},exports.getExtension=function(e,t){for(var r=e.length,n=e.length;n>1;n--){var i=e[n];if(" "===i||"?"===i)r=n;else{if("."===i)return i=e.substring(n+1,r),t?i:i.toLowerCase();if("/"===i||"\\"===i)return""}}return""},exports.getName=function(e){var t=e.length-1,r=e[t];("/"===r||"\\"===r)&&(e=e.substring(0,t));var n=e.lastIndexOf("/");return-1!==n?e.substring(n+1):(n=e.lastIndexOf("\\"),-1===n?e:e.substring(n+1))},exports.setContentType=function(e,t){if("."===e[0]&&(e=e.substring(1)),e.length>8){var r=regexpSTATIC.toString().replace(/,\d+\}/,","+e.length+"}").substring(1);regexpSTATIC=new RegExp(r.substring(0,r.length-1))}return CONTENTTYPES[e]=t,!0},exports.path=function(e,t){return e||(e=""),t=t||"/",e[e.length-1]===t?e:e+t},exports.join=function(){for(var e=[""],t=0;t<arguments.length;t++){var r=arguments[t];if(r){"/"===r[0]&&(r=r.substring(1));var n=r.length-1;"/"===r[n]&&(r=r.substring(0,n)),e.push(r)}}return e=e.join("/"),isWindows&&e.indexOf(":")>-1?e.substring(1):e},exports.$normalize=function(e){return isWindows?e.replace(regexpPATH,"/"):e},exports.random=function(e,t){return e=e||1e5,t=t||0,Math.floor(Math.random()*(e-t+1))+t},exports.GUID=function(e){e=e||40;for(var t="",r=0;e/3+1>r;r++)t+=rnd();return t.substring(0,e)},exports.validate_builder=function(e,t,r,n,i,o,s,a){var u=n[r],c=u.onValidate||F.onValidate||NOOP,l=void 0===i?"":i+".",f=u.properties;a||(a=""),null==e&&(e={});for(var p=0;p<f.length;p++){var h=f[p];if(!s||-1!==s.indexOf(h)){var g=n[r].schema[h];if(!g.can||g.can(e)){var d=e[h],v=typeof d,m=u.resourcePrefix?u.resourcePrefix+h:h;if(void 0!==d)if("function"===v&&(d=e[h]()),g.isArray){if(!(d instanceof Array&&d.length)){t.push(a+h,"@",l+h,o,m);continue}for(var y=0,b=d.length;b>y;y++)if(7===g.type)exports.validate_builder(d[y],t,g.raw,n,l+h+"["+y+"]",y,void 0,a);else{var x=g.validate?g.validate(d[y],e):c(h,d,l+h+"["+y+"]",e,r,g);if(void 0===x){if(x=validate_builder_default(h,d[y],g))continue;v=typeof x,"string"===v?"@"===x[0]?t.push(a+h,"@",l+h+"["+y+"]",y,u.resourcePrefix+x.substring(1)):t.push(a+h,x,l+h+"["+y+"]",y,m):"boolean"===v?!x&&t.push(a+h,"@",l+h+"["+y+"]",y,m):x.isValid===!1&&t.push(a+h,x.error,l+h+"["+y+"]",y,m)}}}else if(7!==g.type){var x=g.validate?g.validate(d,e):c(h,d,l+h,e,r,g);void 0===x&&(x=validate_builder_default(h,d,g))||(v=typeof x,"string"===v?"@"===x[0]?t.push(a+h,"@",l+h,o,u.resourcePrefix+x.substring(1)):t.push(a+h,x,l+h,o,m):"boolean"===v?!x&&t.push(a+h,"@",l+h,o,m):x.isValid===!1&&t.push(a+h,x.error,l+h,o,m))}else exports.validate_builder(d,t,g.raw,n,l+h,void 0,void 0,a);else t.push(a+h,"@",l+h,void 0,m)}}}return t},exports.combine=function(){for(var e=F.directory,t=0,r=arguments.length;r>t;t++){var n=arguments[t];n&&("/"===n[0]&&(n=n.substring(1)),"~"===n[0]?e=n.substring(1):e+=("/"!==e[e.length-1]?"/":"")+n)}return exports.$normalize(e)},exports.removeDiacritics=function(e){return e.replace(regexpDiacritics,function(e){DIACRITICSMAP[e]||e})},exports.parseXML=function(e){for(var t=-1,r=0,n=0,i=[],o={},s=-1;;){if(t=e.indexOf("<![CDATA[",t),-1===t)break;r=e.indexOf("]]>",t+9),e=e.substring(0,t)+e.substring(t+9,r).trim().encode()+e.substring(r+3),t+=9}for(t=-1,r=0;;){if(t=e.indexOf("<",t+1),-1===t)break;if(r=e.indexOf(">",t+1),-1===r)break;var a=e.substring(t,r+1),u=a[1];if("?"!==u&&"/"!==u){n=a.indexOf(" ");var c=!0;-1===n&&(n=a.length-1,c=!1),s=t+a.length;var l="/"===a[a.length-2],f=a.substring(1,n);if(l||i.push(f),c){var p=a.match(regexpXML);if(p){for(var h={},g=p.length,d=0;g>d;d++){var v=p[d].indexOf('"');h[p[d].substring(0,v-1)]=p[d].substring(v+1,p[d].length-1).decode()}o[i.join(".")+(l?"."+f:"")+"[]"]=h}}}else{var m=i.pop();if(-1===s||m!==a.substring(2,a.length-1))continue;var y=(i.length?i.join(".")+".":"")+m,b=e.substring(s,t).decode();void 0===o[y]?o[y]=b:o[y]instanceof Array?o[y].push(b):o[y]=[o[y],b],s=-1}}return o},exports.parseJSON=function(e,t){try{return JSON.parse(e,t?jsonparser:void 0)}catch(r){return null}},exports.parseQuery=function(e){return F.onParseQuery(e)},exports.getWebSocketFrame=function(e,t,r,n){var i=getWebSocketFrameMessageBytes(e,t),o=getWebSocketFrameLengthBytes(i.length),s=exports.createBufferSize(1+o.length+i.length);return s[0]=128|r,n&&(s[0]|=64),o.copy(s,1,0,o.length),i.copy(s,o.length+1,0,i.length),s},exports.distance=function(e,t,r,n){var i=6371,o=(r-e).toRad(),s=(n-t).toRad(),a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e.toRad())*Math.cos(r.toRad())*Math.sin(s/2)*Math.sin(s/2),u=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return(i*u).floor(3)},exports.ls=function(e,t,r){var n,i=new FileList;i.onComplete=t,"string"==typeof r?(n=r.toLowerCase(),r.onFilter=function(e,t,r){return t?!0:r.toLowerCase().indexOf(n)}):exports.isRegExp(r)?(n=r,r.onFilter=function(e,t){return t?!0:n.test(e)}):i.onFilter=r||null,i.walk(e)},exports.ls2=function(e,t,r){var n,i=new FileList;i.advanced=!0,i.onComplete=t,"string"==typeof r?(n=r.toLowerCase(),r.onFilter=function(e,t){return t?!0:e.toLowerCase().indexOf(n)}):exports.isRegExp(r)?(n=r,r.onFilter=function(e,t){return t?!0:n.test(e)}):i.onFilter=r||null,i.walk(e)},Date.prototype.add=function(e,t){var r=this;if(e.constructor===Number)return new Date(r.getTime()+(e-e%1));if(void 0===t){var n=e.split(" ");e=n[1],t=exports.parseInt(n[0])}var i=new Date(r.getTime());switch(e){case"s":case"ss":case"sec":case"second":case"seconds":return i.setSeconds(i.getSeconds()+t),i;case"m":case"mm":case"minute":case"min":case"minutes":return i.setMinutes(i.getMinutes()+t),i;case"h":case"hh":case"hour":case"hours":return i.setHours(i.getHours()+t),i;case"d":case"dd":case"day":case"days":return i.setDate(i.getDate()+t),i;case"w":case"ww":case"week":case"weeks":return i.setDate(i.getDate()+7*t),i;case"M":case"MM":case"month":case"months":return i.setMonth(i.getMonth()+t),i;case"y":case"yyyy":case"year":case"years":return i.setFullYear(i.getFullYear()+t),i}return i},Date.prototype.diff=function(e,t){if(1===arguments.length)t=e,e=Date.now();else{var r=typeof e;"string"===r?e=Date.parse(e):exports.isDate(e)&&(e=e.getTime())}var n=this.getTime()-e;switch(t){case"s":case"ss":case"second":case"seconds":return Math.ceil(n/1e3);case"m":case"mm":case"minute":case"minutes":return Math.ceil(n/1e3/60);case"h":case"hh":case"hour":case"hours":return Math.ceil(n/1e3/60/60);case"d":case"dd":case"day":case"days":return Math.ceil(n/1e3/60/60/24);case"M":case"MM":case"month":case"months":return Math.ceil(n/1e3/60/60/672);case"y":case"yyyy":case"year":case"years":return Math.ceil(n/1e3/60/60/8064)}return NaN},Date.prototype.extend=function(e){var t=new Date(this),r=e.match(regexpDATE);if(!r)return t;for(var n=0,i=r.length;i>n;n++){var o,s,a=r[n];-1===a.indexOf(":")?-1===a.indexOf("-")?-1===a.indexOf(".")||(o=a.split("."),s=+o[0],t.setDate(s),o[1]&&(s=+o[1],!isNaN(s)&&t.setMonth(s-1)),o[2]&&(s=+o[2],!isNaN(s)&&t.setFullYear(s))):(o=a.split("-"),s=+o[0],t.setFullYear(s),o[2]&&(s=+o[2],!isNaN(s)&&t.setDate(s)),o[1]&&(s=+o[1],!isNaN(s)&&t.setMonth(s-1))):(o=a.split(":"),s=+o[0],!isNaN(s)&&t.setHours(s),o[1]&&(s=+o[1],!isNaN(s)&&t.setMinutes(s)),o[2]&&(s=+o[2],!isNaN(s)&&t.setSeconds(s)))}return t},Date.prototype.compare=function(e){var t=this,r=t.getTime()-e.getTime();return 0===r?0:0>r?-1:1},Date.compare=function(e,t){return"string"==typeof e&&(e=e.parseDate()),"string"==typeof t&&(t=t.parseDate()),e.compare(t)},Date.prototype.format=function(e,t){if(!e)return this.getFullYear()+"-"+(this.getMonth()+1).toString().padLeft(2,"0")+"-"+this.getDate().toString().padLeft(2,"0")+"T"+this.getHours().toString().padLeft(2,"0")+":"+this.getMinutes().toString().padLeft(2,"0")+":"+this.getSeconds().toString().padLeft(2,"0")+"."+this.getMilliseconds().toString().padLeft(3,"0")+"Z";if(datetimeformat[e])return datetimeformat[e](this,t);var r=e,n=!1;e&&"!"===e[0]&&(n=!0,e=e.substring(1));var i="'+",o="+'",s=[],a=!1,u=!1,c=!1;return e=e.replace(regexpDATEFORMAT,function(e){switch(e){case"yyyy":return i+"d.getFullYear()"+o;case"yy":return i+"d.getFullYear().toString().substring(2)"+o;case"MMM":return a=!0,i+"(F.resource(resource, mm) || mm).substring(0, 3)"+o;case"MMMM":return a=!0,i+"(F.resource(resource, mm) || mm)"+o;case"MM":return i+"(d.getMonth() + 1).toString().padLeft(2, '0')"+o;case"M":return i+"(d.getMonth() + 1)"+o;case"ddd":return u=!0,i+"(F.resource(resource, dd) || dd).substring(0, 2).toUpperCase()"+o;case"dddd":return u=!0,i+"(F.resource(resource, dd) || dd)"+o;case"dd":return i+"d.getDate().toString().padLeft(2, '0')"+o;case"d":return i+"d.getDate()"+o;case"HH":case"hh":return i+(n?"framework_utils.$pmam(d.getHours()).toString().padLeft(2, '0')":"d.getHours().toString().padLeft(2, '0')")+o;case"H":case"h":return i+(n?"framework_utils(d.getHours())":"d.getHours()")+o;case"mm":return i+"d.getMinutes().toString().padLeft(2, '0')"+o;case"m":return i+"d.getMinutes()"+o;case"ss":return i+"d.getSeconds().toString().padLeft(2, '0')"+o;case"s":return i+"d.getSeconds()"+o;case"w":case"ww":return c=!0,i+("ww"===e?"ww.toString().padLeft(2, '0')":"ww")+o;case"a":var t="'PM':'AM'";return i+"(d.getHours() >= 12 ? "+t+")"+o}}),a&&s.push("var mm = framework_utils.MONTHS[d.getMonth()];"),u&&s.push("var dd = framework_utils.DAYS[d.getDay()];"),c&&s.push("var ww = new Date(+d);ww.setHours(0, 0, 0);ww.setDate(ww.getDate() + 4 - (ww.getDay() || 7));ww = Math.ceil((((ww - new Date(ww.getFullYear(), 0, 1)) / 8.64e7) + 1) / 7);"),datetimeformat[r]=new Function("d","resource",s.join("\n")+"return '"+e+"';"),datetimeformat[r](this,t)},exports.$pmam=function(e){return e>=12?e-12:e},Date.prototype.toUTC=function(e){var t=this.getTime()+6e4*this.getTimezoneOffset();return e?t:new Date(t)},Date.prototype.parseDate=function(){return this},String.prototype.isJSONDate=function(){var e=this.length-1;return e>22&&30>e&&"Z"===this[e]&&"T"===this[10]&&"-"===this[4]&&":"===this[13]&&":"===this[16]},String.prototype.trim||(String.prototype.trim=function(){return this.replace(regexpTRIM,"")}),String.prototype.replaceAt||(String.prototype.replaceAt=function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)}),String.prototype.startsWith=function(e,t){var r,n=this,i=e.length;return t===!0?(r=n.substring(0,i),r.length===i&&r.toLowerCase()===e.toLowerCase()):(r=t?n.substr(t,i):n.substring(0,i),r.length===i&&r===e)},String.prototype.endsWith=function(e,t){var r,n=this,i=e.length;return t===!0?(r=n.substring(n.length-i),r.length===i&&r.toLowerCase()===e.toLowerCase()):(r=t?n.substr(n.length-t-i,i):n.substring(n.length-i),r.length===i&&r===e)},String.prototype.replacer=function(e,t){var r=this,n=r.indexOf(e);return-1===n?r:r.substring(0,n)+t+r.substring(n+e.length)},String.prototype.hash=function(e,t){var r=t?this+t:this;switch(e){case"md5":return r.md5();case"sha1":return r.sha1();case"sha256":return r.sha256();case"sha512":return r.sha512();default:return string_hash(r)}},String.prototype.count=function(e){var t=0,r=0;do t=this.indexOf(e,t+e.length),t>0&&r++;while(t>0);return r},String.prototype.parseXML=function(){return F.onParseXML(this)},String.prototype.parseJSON=function(e){return exports.parseJSON(this,e)},String.prototype.parseQuery=function(){return exports.parseQuery(this)},String.prototype.parseTerminal=function(e,t,r,n){var i=this.split("\n");if("function"==typeof e)return n=r,r=t,t=e,parseTerminal2(i,t,r,n),this;void 0===r&&(r=0),void 0===n&&(n=i.length);var o=[],s=0,a=i[0];if(a||(a=i[1],r++),a||(a=i[2],r++),!a)return this;for(var u,c=e.length,l=0,f=c;f>l;l++){var p=e[l],h=-1,g=-1,d=typeof p;"object"===d&&p.test?(u=a.match(p),u?(h=u.index,g=h+u.toString().length):(h=-1,g=-1)):"string"===d&&(u=a.indexOf(p),-1===u?(h=-1,g=-1):(h=u,g=a.indexOf(" ",h+p.length))),o.push({beg:h,end:g})}for(var l=r+1,f=r+1+n;f>l;l++){var a=i[l];if(a){for(var h,v=[],m=!1,y=0;c>y;y++){var b=o[y];if(-1!==b.beg){m=!0,h=0;for(var x=b.beg;x>-1;x--)if(" "===a[x]){h=x+1;break}v.push(a.substring(h,-1===b.end?void 0:b.end).trim())}else v.push("")}m&&t(v,s++,f,l)}}return this},String.prototype.parseDate=function(){var e=this.trim(),t=e.charCodeAt(e.length-1);if(41===t)return new Date(e);if(90===t)return new Date(Date.parse(e));var r=-1===e.indexOf(" ")?e.split("T"):e.split(" "),n=r[0].indexOf(":"),i=r[0].length;if(-1!==n){var o=r[1];r[1]=r[0],r[0]=o}void 0===r[0]&&(r[0]="");for(var s=void 0===r[1]?!0:0===r[1].length,a=0;i>a;a++){var u=r[0].charCodeAt(a);if(!(45===u||46===u||u>47&&58>u)&&s)return new Date(e)}void 0===r[1]&&(r[1]="00:00:00");var c=-1===r[0].indexOf("-"),l=(r[0]||"").split(c?".":"-"),f=(r[1]||"").split(":"),p=[];if(l.length<4&&f.length<2)return new Date(e);n=(f[2]||"").indexOf("."),-1!==n?(f[3]=f[2].substring(n+1),f[2]=f[2].substring(0,n)):f[3]="0",p.push(+l[c?2:0]),p.push(+l[1]),p.push(+l[c?0:2]),p.push(+f[0]),p.push(+f[1]),p.push(+f[2]),p.push(+f[3]);for(var h=new Date,a=0,i=p.length;i>a;a++){isNaN(p[a])&&(p[a]=0);var g=p[a];if(0===g)switch(a){case 0:0>=g&&(p[a]=h.getFullYear());break;case 1:0>=g&&(p[a]=h.getMonth()+1);break;case 2:0>=g&&(p[a]=h.getDate())}}return new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5])},String.prototype.parseDateExpiration=function(){for(var e=this,t=e.split(" "),r=new Date,n=t.length,i=0;n>i;i+=2){var o=t[i].parseInt();if(0!==o){var s=t[i+1];s&&(r=r.add(s,o))}}return r},String.prototype.contains=function(e,t){var r=this;if("string"==typeof e)return-1!==r.indexOf(e,"number"==typeof t?t:0);for(var n=0,i=e.length;i>n;n++){var o=-1!==r.indexOf(e[n]);if(t){if(!o)return!1}else if(o)return!0}return t},String.prototype.localeCompare2=function(e){return COMPARER(this,e)},String.prototype.parseConfig=function(e){for(var t,r,n,i,o=this.split("\n"),s=o.length,a=exports.extend({},e),u=0;s>u;u++){var c=o[u];if(c&&"#"!==c[0]&&"//"!==c.substring(0,2)&&(n=c.indexOf(" :"),-1!==n||(n=c.indexOf("	:"),-1!==n)))switch(r=c.substring(0,n).trim(),i=c.substring(n+2).trim(),n=r.indexOf("("),-1!==n?(t=r.substring(n+1,r.indexOf(")")).trim().toLowerCase(),r=r.substring(0,n).trim()):t="",t){case"string":a[r]=i;break;case"number":case"float":case"double":case"currency":a[r]=i.isNumber(!0)?i.parseFloat():i.parseInt();break;case"boolean":case"bool":a[r]=i.parseBoolean();break;case"config":a[r]=F.config[i];break;case"eval":case"object":case"array":a[r]=new Function("return "+i)();break;case"json":a[r]=i.parseJSON(!0);break;case"env":case"environment":a[r]=process.env[i];break;case"date":case"time":case"datetime":a[r]=i.parseDate();break;default:a[r]=i}}return a},String.prototype.format=function(){var e=arguments;return this.replace(regexpSTRINGFORMAT,function(t){var r=e[+t.substring(1,t.length-1)];return null==r?"":r})},String.prototype.encode=function(){for(var e="",t=0,r=this.length;r>t;t++){var n=this[t];switch(n){case"<":e+="&lt;";break;case">":e+="&gt;";break;case'"':e+="&quot;";break;case"'":e+="&apos;";break;case"&":e+="&amp;";break;default:e+=n}}return e},String.prototype.decode=function(){return this.replace(regexpDECODE,function(e){if("#"!==e.charAt(1))return ALPHA_INDEX[e]||e;var t="x"===e[2].toLowerCase()?parseInt(e.substr(3),16):parseInt(e.substr(2));return!t||-32768>t||t>65535?"":String.fromCharCode(t)})},String.prototype.urlEncode=function(){return encodeURIComponent(this)},String.prototype.urlDecode=function(){return decodeURIComponent(this)},String.prototype.arg=function(e){return this.replace(regexpARG,function(t){var r=e[t.substring(1,t.length-1).trim()];return null==r?t:r})},String.prototype.params=function(e){OBSOLETE("String.params()","The method is deprecated instead of it use F.viewCompile() or String.format().");var t=this;return null==e?t:t.replace(regexpPARAM,function(t){var r=!1,n=t.substring(2,t.length-2).trim(),i="",o=n.indexOf("|");-1!==o&&(i=n.substring(o+1,n.length).trim(),n=n.substring(0,o).trim()),"!"===n[0]?n=n.substring(1):r=!0;var s;if(-1!==n.indexOf(".")){var a=n.split(".");2===a.length?e[a[0]]&&(s=e[a[0]][a[1]]):3===a.length?e[a[0]]&&e[a[0]][a[1]]&&(s=e[a[0]][a[1]][a[2]]):4===a.length?e[a[0]]&&e[a[0]][a[1]]&&e[a[0]][a[1]][a[2]]&&(s=e[a[0]][a[1]][a[2]][a[3]]):5===a.length&&e[a[0]]&&e[a[0]][a[1]]&&e[a[0]][a[1]][a[2]]&&e[a[0]][a[1]][a[2]][a[3]]&&(s=e[a[0]][a[1]][a[2]][a[3]][a[4]])}else s=n.length?e[n]:e;if("function"==typeof s&&(s=s(o)),void 0===s)return t;if(i.length){var u=typeof s;if("string"===u){var c=+i;isNaN(c)||(s=s.max(c+3,"..."))}else("number"===u||exports.isDate(s))&&(i.isNumber()&&(i=+i),s=s.format(i))}return s=s.toString(),r?exports.encode(s):s})},String.prototype.max=function(e,t){var r=this;return"string"!=typeof t&&(t="..."),r.length>e?r.substring(0,e-t.length)+t:r},String.prototype.isJSON=function(){var e=this;if(e.length<=1)return!1;for(var t,r,n=e.length-1,i=0;;)if(t=e[i++]," "!==t&&"\n"!==t&&"\r"!==t&&"	"!==t)break;for(;;)if(r=e[n--]," "!==r&&"\n"!==r&&"\r"!==r&&"	"!==r)break;return'"'===t&&'"'===r||"["===t&&"]"===r||"{"===t&&"}"===r},String.prototype.isURL=function(){return this.length<=7?!1:F.validators.url.test(this)},String.prototype.isZIP=function(){return F.validators.zip.test(this)},String.prototype.isEmail=function(){return this.length<=4?!1:F.validators.email.test(this)},String.prototype.isPhone=function(){return this.length<6?!1:F.validators.phone.test(this)},String.prototype.isUID=function(){return this.length<18?!1:F.validators.uid.test(this)},String.prototype.parseInt=function(e){var t=this.trim(),r=+t;return isNaN(r)?e||0:r},String.prototype.parseInt2=function(e){var t=this.match(regexpINTEGER);return t?+t[0]:e||0},String.prototype.parseFloat2=function(e){var t=this.match(regexpFLOAT);return t?+t[0].toString().replace(/,/g,"."):e||0},String.prototype.parseBool=String.prototype.parseBoolean=function(){var e=this.toLowerCase();return"true"===e||"1"===e||"on"===e},String.prototype.parseFloat=function(e){var t=this.trim();-1!==t.indexOf(",")&&(t=t.replace(",","."));var r=+t;return isNaN(r)?e||0:r},String.prototype.capitalize=function(e){if(e)return this[0].toUpperCase()+this.substring(1);for(var t,r="",n=0,i=this.length;i>n;n++){var t=this[n-1];t=t&&" "!==t&&"	"!==t&&"\n"!==t?this[n]:this[n].toUpperCase(),r+=t}return r},String.prototype.toUnicode=function(){for(var e="",t=this,r=t.length,n=0;r>n;++n)e+=t.charCodeAt(n)>126||t.charCodeAt(n)<32?"\\u"+t.charCodeAt(n).hex(4):t[n];return e},String.prototype.fromUnicode=function(){return unescape(this.replace(regexpUNICODE,function(e,t){return String.fromCharCode(parseInt(t,16))}))},String.prototype.sha1=function(e){var t=Crypto.createHash("sha1");return t.update(this+(e||""),ENCODING),t.digest("hex")},String.prototype.sha256=function(e){var t=Crypto.createHash("sha256");return t.update(this+(e||""),ENCODING),t.digest("hex")},String.prototype.sha512=function(e){var t=Crypto.createHash("sha512");return t.update(this+(e||""),ENCODING),t.digest("hex")},String.prototype.md5=function(e){var t=Crypto.createHash("md5");return t.update(this+(e||""),ENCODING),t.digest("hex")},String.prototype.toSearch=function(){for(var e=this.replace(regexpSEARCH,"").trim().toLowerCase().removeDiacritics(),t=[],r="",n=0,i=e.length;i>n;n++){var o=e[n];"y"===o&&(o="i"),o!==r&&(r=o,t.push(o))}return t.join("")},String.prototype.toKeywords=String.prototype.keywords=function(e,t,r,n,i){return exports.keywords(this,e,t,r,n,i)},String.prototype.encrypt=function(e,t){var r="0"+this,n=r.length,i=e.length,o=t?exports.random(120)+40:65,s=n+o%i,a=[],u=0;a[0]=String.fromCharCode(o);for(var c=this.length+e.length,l=s-1;l>0;l--)u=r.charCodeAt(l%n),a[l]=String.fromCharCode(u^(e.charCodeAt(l%i)^o));var f=exports.createBuffer(c+"="+a.join(""),ENCODING).toString("base64").replace(regexpENCRYPT,function(e){return"+"===e?"_":"-"});return u=f.indexOf("="),u>0?f.substring(0,u):f},String.prototype.decrypt=function(e){var t=this.replace(regexpDECRYPT,function(e){return"-"===e?"/":"+"}),r=t.length%4;if(r)for(var n=0;r>n;n++)t+="=";t=exports.createBuffer(t,"base64").toString(ENCODING);var i=t.indexOf("=");if(-1===i)return null;var o=+t.substring(0,i);if(isNaN(o))return null;t=t.substring(i+1);for(var s=t.length,a=t.charCodeAt(0),u=e.length,c=s-a%u,l=[],n=c-1;n>0;n--)i=t.charCodeAt(n)^(a^e.charCodeAt(n%u)),l[n]=String.fromCharCode(i);var f=l.join("");return o!==f.length+e.length?null:f},String.prototype.base64ToFile=function(e,t){var r=this,n=r.indexOf(",");return-1===n?n=0:n++,Fs.writeFile(e,r.substring(n),"base64",t||exports.noop),this},String.prototype.base64ToBuffer=function(){var e=this,t=e.indexOf(",");return-1===t?t=0:t++,exports.createBuffer(e.substring(t),"base64")},String.prototype.base64ContentType=function(){var e=this,t=e.indexOf(";");return-1===t?"":e.substring(5,t)},String.prototype.removeDiacritics=function(){return exports.removeDiacritics(this)},String.prototype.indent=function(e,t){var r="";for(void 0===t&&(t=" ");e--;)r+=t;return r+this},String.prototype.isNumber=function(e){var t=this,r=t.length;if(!r)return!1;e=e||!1;for(var n=0;r>n;n++){var i=t.charCodeAt(n);if(!e||44!==i&&46!==i){if(48>i||i>57)return!1}else e=!1}return!0},String.prototype.padLeft||(String.prototype.padLeft=function(e,t){var r=this,n=e-r.length;if(0>n)return r;for(void 0===t&&(t=" ");n--;)r=t+r;return r}),String.prototype.padRight||(String.prototype.padRight=function(e,t){var r=this,n=e-r.length;if(0>n)return r;for(void 0===t&&(t=" ");n--;)r+=t;return r}),String.prototype.insert=function(e,t){var r=this,n=r.substring(0,e),i=t.toString()+r.substring(e);return n+i},String.prototype.slug=String.prototype.toSlug=String.prototype.toLinker=String.prototype.linker=function(e){e=e||60;for(var t=this.trim().toLowerCase().removeDiacritics(),r="",n=t.length,i=0;n>i;i++){var o=t[i],s=t.charCodeAt(i);if(r.length>=e)break;s>31&&48>s?"-"!==r[r.length-1]&&(r+="-"):(s>47&&58>s||s>94&&123>s)&&(r+=o)}var a=r.length-1;return"-"===r[a]?r.substring(0,a):r},String.prototype.pluralize=function(e,t,r,n){return this.parseInt().pluralize(e,t,r,n)},String.prototype.isBoolean=function(){var e=this.toLowerCase();return"true"===e||"false"===e?!0:!1},String.prototype.isAlphaNumeric=function(){return regexpALPHA.test(this)},String.prototype.soundex=function(){for(var e=this.toLowerCase().split(""),t=e.shift(),r=t.toUpperCase(),n=0,i=e.length;i>n;n++){var o=SOUNDEX[e[n]];void 0!==o&&(n?o!==e[n-1]&&(r+=o):o!==SOUNDEX[t]&&(r+=o))}return(r+"000").substring(0,4)},String.prototype.removeTags=function(){return this.replace(regexpTags,"")},Number.prototype.floor=function(e){return Math.floor(this*Math.pow(10,e))/Math.pow(10,e)},Number.prototype.padLeft=function(e,t){return this.toString().padLeft(e,t||"0")},Number.prototype.padRight=function(e,t){return this.toString().padRight(e,t||"0")},Number.prototype.async=function(e,t){var r=this;return r?e(r--,function(){return setImmediate(function(){return r.async(e,t)})}):t&&t(),r},Number.prototype.format=function(e,t,r){var n=this;if("string"==typeof e)return n.format2(e);var i=n.toString(),o="",s="",a="-"===i[0]?"-":"";a&&(i=i.substring(1));var u=i.indexOf(".");if("string"==typeof e){var c=t;t=e,e=c}void 0===t&&(t=" "),-1!==u&&(o=i.substring(u+1),i=i.substring(0,u)),u=-1;for(var l=i.length-1;l>=0;l--)u++,u>0&&u%3===0&&(s=t+s),s=i[l]+s;return(e||o.length)&&(o=o.length>e?o.substring(0,e||0):o.padRight(e||0,"0")),o.length&&void 0===r&&(r="."===t?",":"."),a+s+(o.length?r+o:"")},Number.prototype.add=function(e,t){if(null==e)return this;if("number"==typeof e)return this+e;var r=e.charCodeAt(0),n=!1;(48>r||r>57)&&(n=!0,e=e.substring(1));var i,o=e.length;if("%"===e[o-1]){if(e=e.substring(0,o-1),n){var s=e.parseFloat();switch(r){case 42:i=this*(this/100*s);break;case 43:i=this+this/100*s;break;case 45:i=this-this/100*s;break;case 47:i=this/(this/100*s)}return void 0!==t?i.floor(t):i}return i=this/100*e.parseFloat(),void 0!==t?i.floor(t):i}switch(i=e.parseFloat(),r){case 42:i=this*i;break;case 43:i=this+i;break;case 45:i=this-i;break;case 47:i=this/i;break;default:i=this}return void 0!==t?i.floor(t):i},Number.prototype.format2=function(e){var t=0,r=this.toString(),n=0,i=0,o=0,s="",a=0;if("string"==typeof e){var u=!1;a=e.length;for(var c=0;a>c;c++){var l=e[c];"#"===l&&(u?i++:n++),"."===l&&(u=!0)}var f=r,p="";if(t=r.indexOf("."),-1!==t&&(f=r.substring(0,t),p=r.substring(t+1)),f.length>n){o=f.length-n;for(var h="",c=0;o>c;c++)h+="#";e=h+e}f.length<n&&(f=f.padLeft(n," ")),p.length<i&&(p=p.padRight(i,"0")),p.length>i&&(p=p.substring(0,i)),u=!1,t=0;var g=!0;a=e.length;for(var c=0;a>c;c++){var l=e[c];if("#"===l){var d=u?p[t]:f[t];g&&(g=-1!==[","," "].indexOf(d)),g||(s+=d),t++}else{if(g)continue;"."===l&&(u=!0,t=0),s+=l}}return s}if(s="### ### ###",n=r.indexOf("."),o=e||0,0===o&&-1!==n&&(o=r.length-(n+1)),o>0){s+=".";for(var c=0;o>c;c++)s+="#"}return this.format(s)},Number.prototype.pluralize=function(e,t,r,n){var i=this,o="";o=0==i?e||"":1==i?t||"":i>1&&5>i?r||"":n;var s=o.indexOf("#");if(-1===s)return o;var a=o.lastIndexOf("#"),u=o.substring(s,a+1);return i.format(u)+o.replace(u,"")},Number.prototype.hex=function(e){for(var t=this.toString(16).toUpperCase();t.length<e;)t="0"+t;return t},Number.prototype.VAT=function(e,t,r){var n=this,i=typeof t;if("boolean"===i){var o=r;r=t,t=o,i=typeof t}return"undefined"===i&&(t=2),void 0===r&&(r=!0),e&&n?r?(n/(e/100+1)).floor(t):(n*(e/100+1)).floor(t):n},Number.prototype.discount=function(e,t){var r=this;return void 0===t&&(t=2),(r-r/100*e).floor(t)},Number.prototype.parseDate=function(e){return new Date(this+(e||0))},Number.prototype.toRad||(Number.prototype.toRad=function(){return this*Math.PI/180}),Number.prototype.filesize=function(e,t){if("string"==typeof e){var r=t;t=e,e=r}var n;switch(t){case"bytes":n=this;break;case"KB":n=this/1024;break;case"MB":n=filesizehelper(this,2);break;case"GB":n=filesizehelper(this,3);break;case"TB":n=filesizehelper(this,4);break;default:t="bytes",n=this,n>1023&&(n/=1024,t="KB"),n>1023&&(n/=1024,t="MB"),n>1023&&(n/=1024,t="GB"),n>1023&&(n/=1024,t="TB")}return t=" "+t,(void 0===e?n.format(2).replace(".00",""):n.format(e))+t},Array.prototype.take=function(e){for(var t=[],r=this,n=r.length,i=0;n>i;i++)if(t.push(r[i]),t.length>=e)return t;return t},Array.prototype.extend=function(e,t){for(var r="function"==typeof e,n=0,i=this.length;i>n;n++)r?this[n]=e(this[n],n):this[n]=exports.extend(this[n],e,t);return this},Array.prototype.first=function(e){var t=this[0];return void 0===t?e:t},Array.prototype.toObject=function(e){for(var t=this,r={},n=0,i=t.length;i>n;n++){var o=t[n];e?r[o[e]]=o:r[o]=!0}return r},Array.prototype.compare=function(e,t,r){for(var n=this,i={},o={},s=n.length,a=t.length,u=Math.max(s,a),c={},l=0;u>l;l++){var f=n[l];f&&(i[f[e]]=l);var p=t[l];p&&(o[p[e]]=l)}for(var h=-1,l=0;u>l;l++){var g,d,f=n[l],p=t[l];if(f){if(g=f[e],c[g])continue;c[g]=!0,h=o[g],void 0===h?r(f,void 0,l,-1):r(f,t[h],l,h)}if(p){if(d=p[e],c[d])continue;c[d]=!0,h=i[d],void 0===h?r(void 0,p,-1,l):r(n[h],p,h,l)}}},Array.prototype.pair=function(e,t,r,n){if(e instanceof Array){var i=e;e=t,t=i}t||(t=new Array(0));for(var o=t.length,s=0;;){var a=this[s++];if(!a)break;for(var u=!1,c=0;o>c;c++)if(a[e]===t[c][e]){r(a,t[c]),u=!0;break}!u&&n&&(s--,this.splice(s,1))}return this},Array.prototype.last=function(e){var t=this[this.length-1];return void 0===t?e:t},Array.prototype.quicksort=Array.prototype.orderBy=function(e,t){var r=this.length;if(!r||1===r)return this;"boolean"==typeof e&&(t=e,e=void 0),void 0===t&&(t=!0);var n=this,i=0,o=e?n[0][e]:n[0];switch(typeof o){case"string":i=o.isJSONDate()?4:1;break;case"number":i=2;break;case"boolean":i=3;break;default:if(!exports.isDate(o))return n;i=4}return shellsort(n,function(r,n){var o=e?r[e]:r,s=e?n[e]:n;if(1===i)return o&&s?t?COMPARER(o,s):COMPARER(s,o):0;if(2===i)return o>s?t?1:-1:s>o?t?-1:1:0;if(3===i)return o===!0&&s===!1?t?1:-1:o===!1&&s===!0?t?-1:1:0;if(4===i){if(!o||!s)return 0;o.getTime||(o=new Date(o)),s.getTime||(s=new Date(s));var a=o.getTime(),u=s.getTime();return a>u?t?1:-1:u>a?t?-1:1:0}return 0}),n},Array.prototype.trim=function(){for(var e=this,t=[],r=0,n=e.length;n>r;r++)"string"==typeof e[r]&&(e[r]=e[r].trim()),e[r]&&t.push(e[r]);return t},Array.prototype.skip=function(e){for(var t=[],r=this,n=r.length,i=0;n>i;i++)i>=e&&t.push(r[i]);return t},Array.prototype.where=function(e,t){for(var r=this,n=[],i="function"==typeof e,o=void 0!==t,s=0,a=r.length;a>s;s++)i?e.call(r,r[s],s)&&n.push(r[s]):o?r[s]&&r[s][e]===t&&n.push(r[s]):r[s]===e&&n.push(r[s]);return n},Array.prototype.findItem=Array.prototype.find=function(e,t){var r=this,n=r.findIndex(e,t);return-1===n?null:r[n]},Array.prototype.findIndex=function(e,t){for(var r=this,n="function"==typeof e,i=void 0!==t,o=0,s=r.length;s>o;o++)if(n){if(e.call(r,r[o],o))return o}else if(i){if(r[o]&&r[o][e]===t)return o}else if(r[o]===e)return o;return-1},Array.prototype.remove=function(e,t){for(var r=this,n=[],i="function"==typeof e,o=void 0!==t,s=0,a=r.length;a>s;s++)i?!e.call(r,r[s],s)&&n.push(r[s]):o?r[s]&&r[s][e]!==t&&n.push(r[s]):r[s]!==e&&n.push(r[s]);return n},Array.prototype.wait=Array.prototype.waitFor=function(e,t,r,n){var i=this,o=!1;n||("function"!=typeof t&&(r=t,t=null),n={},n.pending=0,n.index=0,n.thread=r,o=!0);var s=r===!0?i.shift():i[n.index++];if(void 0===s)return n.pending||(t&&t(),n.cancel=!0),i;if(n.pending++,e.call(i,s,function(){return setImmediate(next_wait,i,e,t,r,n)},n.index),!o||1===n.thread)return i;for(var a=1;a<n.thread;a++)i.wait(e,t,1,n);return i},Array.prototype.async=function(e,t,r){var n=this;"function"==typeof e?(t=e,e=1):void 0===e&&(e=1),void 0===r&&(r=0);var i=n.shift();if(void 0===i)return r||(r=void 0,t&&t()),n;for(var o=0;e>o;o++)o&&(i=n.shift()),r++,i(function(){setImmediate(function(){r--,n.async(1,t,r)})});return n},Array.prototype.randomize=function(){return OBSOLETE("Array.randomize()","Use Array.random()."),this.random()},Array.prototype.random=function(){for(var e=this.length-1;e>0;e--){var t=Math.floor(Math.random()*(e+1)),r=this[e];this[e]=this[t],this[t]=r}return this},Array.prototype.limit=function(e,t,r,n){void 0===n&&(n=0);for(var i=[],o=this,s=n+e,a=n;s>a;a++){var u=o[a];{if(void 0===u)return i.length?(t(i,function(){return r&&r()},n,n+e),o):(r&&r(),o);i.push(u)}}return i.length?(t(i,function(){s<o.length?o.limit(e,t,r,s):r&&r()},n,n+e),o):(r&&r(),o)},Array.prototype.unique=function(e){for(var t=this,r=[],n=0,i=0,o=t.length;o>i;i++){var s=t[i];if(e)if(0!==n){for(var a=!0,u=0;n>u;u++)if(r[u][e]===s[e]){a=!1;break}a&&(r.push(s),n++)}else r.push(s),n++;else-1===r.indexOf(s)&&r.push(s)}return r},ArrayBuffer.prototype.toBuffer=function(){for(var e=new Buffer(this.byteLength),t=new Uint8Array(this),r=0,n=e.length;n>r;++r)e[r]=t[r];return e},AsyncTask.prototype.run=function(){var e=this;try{if(e.isCanceled)return e.complete(),e;e.isRunning=1,e.owner.tasksWaiting[e.name]=!0,e.owner.emit("begin",e.name);var t=e.owner.tasksTimeout[e.name];t>0&&(e.interval=setTimeout(function(){e.timeout()},t)),e.fn(function(){setImmediate(function(){return e.complete()})})}catch(r){e.owner.emit("error",e.name,r),e.complete()}return e},AsyncTask.prototype.timeout=function(e){var t=this;return e>0?(clearTimeout(t.interval),setTimeout(function(){t.timeout()},e),t):0>=e?(clearTimeout(t.interval),setTimeout(function(){t.timeout()},e),t):(setImmediate(function(){return t.cancel(!0)}),t)},AsyncTask.prototype.cancel=function(e){var t=this;return t.isCanceled=!0,e?t.owner.emit("timeout",t.name):t.owner.emit("cancel",t.name),t.fn=null,t.cb=null,t.complete(),t},AsyncTask.prototype.complete=function(){var e=this,t=e.owner;if(e.isRunning=2,delete t.tasksPending[e.name],delete t.tasksWaiting[e.name],!e.isCanceled)try{t.emit("end",e.name),e.cb&&e.cb()}catch(r){t.emit("error",r,e.name)}return setImmediate(function(){t.reload(),t.refresh()}),t},Async.prototype.__defineGetter__("count",function(){return this._count}),Async.prototype.__defineGetter__("percentage",function(){var e=100-Math.floor(100*this._count/this._max);return e?e:0}),Async.prototype.__proto__=Object.create(Events.EventEmitter.prototype,{constructor:{value:Async,enumberable:!1}}),Async.prototype.reload=function(){var e=this;return e.tasksAll=Object.keys(e.tasksPending),e.emit("percentage",e.percentage),e},Async.prototype.cancel=function(e){var t=this;if(void 0===e){t.isCanceled=!0;for(var r=0;r<t._count;r++)t.cancel(t.tasksAll[r]);return!0}var n=t.tasksPending[e];return n?(delete t.tasksPending[e],delete t.tasksWaiting[e],n.cancel(),n=null,t.reload(),t.refresh(),!0):!1},Async.prototype.await=function(e,t,r){var n=this;return n.isCanceled?!1:("function"==typeof e&&(r=t,t=e,e=exports.GUID(6)),n.tasksPending[e]?!1:(n.tasksPending[e]=new AsyncTask(n,e,t,r,null),n._max++,n.reload(),n.refresh(),!0))},Async.prototype.wait=function(e,t,r,n){var i=this;return i.isCanceled?!1:("function"==typeof t&&(n=r,r=t,t=null),i.tasksPending[e]?!1:(i.tasksPending[e]=new AsyncTask(i,e,r,n,t),i._max++,i.reload(),i.refresh(),!0))},Async.prototype.complete=function(e){return this.run(e)},Async.prototype.run=function(e){return this._isRunning=!0,e&&this.onComplete.push(e),this.refresh(),this},Async.prototype.isRunning=function(e){if(!e)return this._isRunning;var t=this.tasksPending[e];return t?1===t.isRunning:!1},Async.prototype.isWaiting=function(e){var t=this.tasksPending[e];return t?0===t.isRunning:!1},Async.prototype.isPending=function(e){return this.tasksPending[e]?!0:!1},Async.prototype.timeout=function(e,t){return t?this.tasksTimeout[e]=t:this.tasksTimeout[e]=void 0,this},Async.prototype.refresh=function(e){var t=this;if(!t._isRunning||t._isEnd)return t;t._count=t.tasksAll.length;for(var r=0;;){var e=t.tasksAll[r++];if(!e)break;var n=t.tasksPending[e];if(!n)break;t.isCanceled||n.isCanceled?(delete t.tasksPending[e],delete t.tasksWaiting[e],t.tasksAll.splice(r,1),t._count=t.tasksAll.length,r--):0!==n.isRunning||n.waiting&&t.tasksPending[n.waiting]||n.run()}if(0===t._count){t._isRunning=!1,t._isEnd=!0,t.emit("complete"),t.emit("percentage",100),t._max=0;var i=t.onComplete,o=i.length;t.onComplete=[];for(var s=0;o>s;s++)try{i[s]()}catch(a){t.emit("error",a)}setImmediate(function(){return t._isEnd=!1})}return t},FileList.prototype.reset=function(){return this.file.length=0,this.directory.length=0,this.pendingDirectory.length=0,this},FileList.prototype.walk=function(e){var t=this;if(e instanceof Array){for(var r=e.length,n=0;r>n;n++)t.pendingDirectory.push(e[n]);return void t.next()}Fs.readdir(e,function(r,n){if(r)return t.next();for(var i=n.length,o=0;i>o;o++)t.pending.push(Path.join(e,n[o]));t.next()})},FileList.prototype.stat=function(e){var t=this;Fs.stat(e,function(r,n){return r?t.next():(n.isDirectory()?(e=t.clean(e),(!t.onFilter||t.onFilter(e,!0))&&(t.directory.push(e),t.pendingDirectory.push(e))):(!t.onFilter||t.onFilter(e,!1))&&t.file.push(t.advanced?{filename:e,stats:n}:e),void t.next())})},FileList.prototype.clean=function(e){return"/"===e[e.length-1]?e:e+"/"},FileList.prototype.next=function(){var e=this;if(e.pending.length){var t=e.pending.shift();return void e.stat(t)}if(e.pendingDirectory.length){var r=e.pendingDirectory.shift();return void e.walk(r)}e.onComplete(e.file,e.directory)},exports.Async=Async,exports.sync=function(e,t){return function(){var r,n,i=[].slice.call(arguments),o=!1,s=t||this;return i.push(function(){r=arguments,!o&&n&&(o=!0,n.apply(s,r))}),e.apply(s,i),function(e){n=e,!o&&r&&(o=!0,n.apply(s,r))}}},exports.sync2=function(e,t){return function(){var r,n,i=!1,o=t||this,s=[].slice.call(arguments);return s.push(function(){r=arguments,!i&&n&&(i=!0,n.apply(o,r))}),e.apply(o,s),function(e){n=e,!i&&r&&(i=!0,n.apply(o,r))}}()},exports.async=function(e,t){var r=this;return function(n){function i(e,t){var r,o;try{var a=e?!1:!0;switch(a){case!0:r=u.next(t);break;case!1:r=u["throw"](e)}}catch(c){if(!n)return;return o=typeof n,"object"===o&&n.isController?void(c instanceof ErrorBuilder?n.content(c):n.view500(c)):void("function"===o&&setImmediate(function(){return n(c)}))}if(r.done)return void("function"==typeof n&&n(null,r.value));var l=r.value instanceof Promise;if("function"!=typeof r.value&&!l)return void i.call(s,null,r.value);try{if(l)return void r.value.then(function(e){return i.call(s,null,e)});r.value.call(s,function(){i.apply(s,arguments)})}catch(c){setImmediate(function(){return i.call(s,c)})}}var o,s=this;if(arguments.length)if(t)o=arguments[1];else{o=[];for(var a=1;a<arguments.length;a++)o.push(arguments[a])}else o=new Array(0);var u=e.apply(r,o);return i(null),u.value}};const CACHE_GML1=[null,null,0,0,0,0,0,0],CACHE_GML2=[null,null,null,null,null,null,null,null];exports.getMessageLength=function(e,t){var r=127&e[1];return 126===r?e.length<4?-1:(CACHE_GML1[0]=e[3],CACHE_GML1[1]=e[2],converBytesToInt64(CACHE_GML1,0,t)):127===r?e.Length<10?-1:(CACHE_GML2[0]=e[9],CACHE_GML2[1]=e[8],CACHE_GML2[2]=e[7],CACHE_GML2[3]=e[6],CACHE_GML2[4]=e[5],CACHE_GML2[5]=e[4],CACHE_GML2[6]=e[3],CACHE_GML2[7]=e[2],converBytesToInt64(CACHE_GML2,0,t)):r},exports.queuecache={},exports.queue=function(e,t,r){if(!r)return!1;if(!t)return r(NOOP),!0;exports.queuecache[e]||(exports.queuecache[e]={limit:t,running:0,pending:[]});var n=exports.queuecache[e];return n.running>=n.limit?(n.pending.push(r),!1):(n.running++,setImmediate(queue_next_callback,r,e),!0)},exports.minifyStyle=function(e){return require("./internal").compile_css(e)},exports.minifyScript=function(e){return require("./internal").compile_javascript(e)},exports.minifyHTML=function(e){return require("./internal").compile_html(e)},exports.restart=function(){exports.queuecache={},dnscache={}},exports.parseTheme=function(e){if("="!==e[0])return"";var t=e.indexOf("/",2);return-1===t?"":(e=e.substring(1,t),"?"===e?F.config["default-theme"]:e)},exports.set=function(e,t,r){var n="S+"+t;if(F.temporary.other[n])return F.temporary.other[n](e,r);for(var i=t.split("."),o=[],s="",a=0,u=i.length;u>a;a++){s+=(""!==s?".":"")+i[a];var c=i[a]instanceof Array?"[]":"{}";{if(a===u-1){if("{}"===c)break;s=s.substring(0,s.lastIndexOf("[")),o.push("if(!(w."+s+" instanceof Array))w."+s+"="+c);break}o.push("if(typeof(w."+s+')!=="object"||w.'+s+"===null)w."+s+"="+c)}}var l=new Function("w","a","b",o.join(";")+";w."+t.replace(/'/,"'")+"=a;return a");F.temporary.other[n]=l,l(e,r,t)},exports.get=function(e,t){var r="G="+t;if(F.temporary.other[r])return F.temporary.other[r](e);for(var n=t.split("."),i=[],o="",s=0,a=n.length-1;a>s;s++){var u=n[s],c=u.lastIndexOf("[");-1!==c&&i.push("if(!w."+(o?o+".":"")+u.substring(0,c)+")return"),o+=(""!==o?".":"")+n[s],i.push("if(!w."+o+")return")}var l=new Function("w",i.join(";")+";return w."+t.replace(/'/,"'"));return F.temporary.other[r]=l,l(e)},global.Async=global.async=exports.async,global.sync=global.SYNCHRONIZE=exports.sync,global.sync2=exports.sync2,EventEmitter2.prototype.emit=function(e,t,r,n,i,o,s,a){var u=this.$events[e];if(u){for(var c=!1,l=0,f=u.length;f>l;l++)u[l].$once&&(c=!0),u[l].call(this,t,r,n,i,o,s,a);c&&(u=u.remove(function(e){return e.$once}),u.length?this.$events[e]=u:this.$events[e]=void 0)}return this},EventEmitter2.prototype.on=function(e,t){return this.$events[e]?this.$events[e].push(t):this.$events[e]=[t],this},EventEmitter2.prototype.once=function(e,t){return t.$once=!0,this.on(e,t)},EventEmitter2.prototype.removeListener=function(e,t){var r=this.$events[e];return r&&(r=r.remove(function(e){return e===t}),r.length?this.$events[e]=r:this.$events[e]=void 0),this},EventEmitter2.prototype.removeAllListeners=function(e){return e===!0?this.$events=EMPTYOBJECT:e?this.$events[e]=void 0:this.$events={},this},exports.EventEmitter2=EventEmitter2,Chunker.prototype.append=Chunker.prototype.write=function(e){var t=this;t.stack.push(e);var r=t.stack.length;return r>=t.max&&(t.flushing++,t.pages++,t.count+=r,Fs.writeFile(t.filename+t.index++ +".json",JSON.stringify(t.stack),function(){return t.flushing--}),t.stack=[]),t},Chunker.prototype.end=function(){var e=this,t=e.stack.length;return t&&(e.flushing++,e.pages++,e.count+=t,Fs.writeFile(e.filename+e.index++ +".json",JSON.stringify(e.stack),function(){return e.flushing--}),e.stack=[]),e},Chunker.prototype.each=function(e,t,r){var n=this;return void 0===r&&(r=0),r>=n.index?t&&t():(n.read(r++,function(i,o){e(o,function(){return n.each(e,t,r)},r-1)}),n)},Chunker.prototype.read=function(e,t){var r=this;return r.flushing?void(r.flushing_timeout=setTimeout(function(){return r.read(e,t)},300)):(Fs.readFile(r.filename+e+".json",function(e,r){e?t(null,EMPTYARRAY):t(null,r.toString("utf8").parseJSON(!0))}),r)},Chunker.prototype.clear=function(){for(var e=[],t=0;t<this.index;t++)e.push(this.filename+t+".json");return e.wait(function(e,t){return Fs.unlink(e,t)}),this},Chunker.prototype.destroy=function(){return this.clear(),this.indexer=0,this.flushing=0,clearTimeout(this.flushing_timeout),this.stack=null,this},exports.chunker=function(e,t){return new Chunker(e,t)},exports.Chunker=Chunker,exports.ObjectToArray=function(e){if(null==e)return EMPTYARRAY;for(var t=Object.keys(e),r=[],n=0,i=t.length;i>n;n++)r.push({key:t[n],value:e[t[n]]});return r},NODEVERSION>699?(exports.createBufferSize=function(e){return Buffer.alloc(e||0)},exports.createBuffer=function(e,t){return Buffer.from(e||"",t)}):(exports.createBufferSize=function(e){return new Buffer(e||0)},exports.createBuffer=function(e,t){return new Buffer(e||"",t)}),global.WAIT=exports.wait,!global.F&&require("./index");